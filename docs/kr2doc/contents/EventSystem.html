<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!-- generated by to_html.pl from EventSystem.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>事件系统</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关参考用标准样式" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="首页" />
</head>
<body>
<h1><a id="id96" name="id96">关于事件系统</a>
</h1><div class="para"><div>
　在吉里吉里中编写TJS脚本时，需要采用事件驱动型的编程模型。<br />
　事件在"某事发生"时，为了通知其他对象或自身对象而产生。事件处理程序中需要编写响应这些事件的处理。<br />
　在吉里吉里中，一个事件处理程序花费过长时间是不合适的。如果需要等待时间，建议使用<a target="main" class="jump" href="f_Timer.html">Timer</a>类。<br />
</div></div>
<h1><a id="id97" name="id97">同步事件和异步事件</a>
</h1><div class="para"><div>
　同步事件是指，例如当音频缓冲区开始播放时，在其play方法内部立即触发onStatusChanged事件，这种在执行对象操作时立即在当场发生的事件。<br />
　与此相对，异步事件会临时存储在吉里吉里内部的事件队列（暂时保存待触发事件的地方）中。这些事件直到所有其他事件处理程序处理完毕前不会触发，且不会在其他事件处理程序内触发（但有例外，请参阅下面的注释）。定时器周期到达时触发的onTimer事件以及由用户输入触发的所有事件都是异步事件。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">注意</span></div>
　像Window.showModal这样的一些需要获取用户输入的功能，会使事件队列运行（即分发事件）。因此，在事件处理程序中可能会触发其他异步事件。</div><br />
　为了通过脚本操作触发异步事件，提供了<a target="main" class="jump" href="f_AsyncTrigger.html">AsyncTrigger</a>类。<br />
</div></div>
<h1><a id="id98" name="id98">屏幕刷新的时机</a>
</h1><div class="para"><div>
　在窗口中显示图层的屏幕刷新时机与异步事件相同，即在所有其他事件处理程序处理完成之后。在一个事件处理程序内多次进行绘制，虽然内部的图像缓冲区已经更新，但不会立即反映到屏幕上。只有当事件处理程序退出后，吉里吉里获得绘制时机时，内容才会被绘制到窗口并反映出来。<br />
</div></div>
<h1><a id="id99" name="id99">类内的事件处理程序</a>
</h1><div class="para"><div>
　类内发生的事件可以通过重写父类的事件处理程序来处理。<br />
　例如，可以创建Timer类的子类，并按以下方式创建事件处理程序：<br />

<br />
<code class="bq">class&nbsp;MyTimer&nbsp;extends&nbsp;Timer<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;MyTimer()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.Timer(...);<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;onTimer()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;(这里是onTimer的处理)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.onTimer(...);&nbsp;<span class="comment">//&nbsp;一般还是调用父类的方法</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
}<br />
</code>
<br />

　不一定需要调用父类的方法，但一般会调用。另外，如果不调用父类的方法，后面将提到的action方法进行的事件处理将无法进行。<br />
</div></div>
<h1><a id="id100" name="id100">action方法</a>
</h1><div class="para"><div>
　<a target="main" class="jump" href="f_Layer.html">Layer</a>类和<a target="main" class="jump" href="f_WaveSoundBuffer.html">WaveSoundBuffer</a>类等具有向构造函数中指定的所有者的action方法发送事件的功能。<br />
　action方法接收一个字典数组对象作为参数，其中包含事件信息。<br />
　字典数组成员中，target表示事件发生源对象，type表示事件名称。<br />
　其他成员因事件而异。例如，对于<a target="main" class="jump" href="f_Layer_onClick.html">Layer.onClick</a>事件，有x和y成员，表示图层上被点击的位置。<br />

<br />
<code class="bq">例:<br />
class&nbsp;MyWindow&nbsp;extends&nbsp;Window<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;layer;<br />
&nbsp;&nbsp;&nbsp;&nbsp;(略)<br />
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;MyWindow()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.Window(...);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add(layer&nbsp;=&nbsp;new&nbsp;Layer(this&nbsp;<span class="comment">/*&nbsp;this&nbsp;=&nbsp;所有者&nbsp;*/</span>,&nbsp;null));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layer.visible&nbsp;=&nbsp;true;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;(略)<br />
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;action(ev)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ev.type&nbsp;==&nbsp;&quot;onClick&quot;&nbsp;&amp;&amp;&nbsp;ev.target&nbsp;==&nbsp;layer)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;layer被点击了</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.inform(ev.x,&nbsp;ev.y);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
}<br />
</code>
<br />

</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
