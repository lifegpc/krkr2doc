<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!-- generated by to_html.pl from Debug.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>调试</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关参考用标准样式" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="首页" />
</head>
<body>
<h1><a id="id93" name="id93">关于应用程序的调试</a>
</h1><div class="para"><div>
　调试是指，确定并修复应用程序中的bug（功能故障或意外行为的原因）的工作。<br />
　吉里吉里拥有几项调试支持功能，可以利用这些功能来调试应用程序。下面将对这些方法进行说明。</div></div>
<h1><a id="id94" name="id94">调试支持窗口</a>
</h1><div class="para"><div>
吉里吉里提供了几个用于支持调试的窗口。详情请参阅各链接的说明。<br />
<dl>
<dt><a target="main" class="jump" href="Controller.html">控制器</a></dt>
<dd>可以打开各种调试支持窗口，停止事件触发，转储TJS上下文，创建消息映射文件，强制终止系统等。</dd>
<dt><a target="main" class="jump" href="ScriptEditor.html">脚本编辑器</a></dt>
<dd>可以编辑简单的TJS脚本并执行。此外，当发生异常时，可能会打开一个名为"脚本编辑器（异常通知）"的脚本编辑器窗口，用于指示异常发生的位置。</dd>
<dt><a target="main" class="jump" href="ExprWatch.html">监视表达式</a></dt>
<dd>可以一次性查看多个表达式的结果。</dd>
<dt><a target="main" class="jump" href="Console.html">控制台</a></dt>
<dd>可以显示吉里吉里系统和用户脚本输出的各种调试信息。此外，还可以输入TJS2表达式并立即执行，显示表达式的结果。</dd></dl><br />
　特别是在控制台中，通过<a target="main" class="jump" href="f_Debug_message.html">Debug.message</a>可以显示用户程序在程序中输出的消息。可以在程序的任意位置调用此方法，将变量内容显示在控制台上，查看执行中的变量内容。<br />
　另外，在控制台下部的输入框中输入TJS2表达式并按Enter键，就可以立即执行该表达式。这在直接调用正在执行的对象的方法，或者给对象属性或变量赋值时非常方便。<br />
　关于向控制台显示消息或将日志写入文件的方法，请参考<a target="main" class="jump" href="CommandLine.html">命令行选项</a>中的"调试相关选项"或<a target="main" class="jump" href="f_Debug.html">Debug类</a>。<br />
</div></div>

<h1><a id="id95" name="id95">调试模式</a>
</h1><div class="para"><div>
　在<a target="main" class="jump" href="CommandLine.html">命令行选项</a>中指定'-debug'（将"调试模式"设为'启用'），可以让吉里吉里在调试模式下运行。<br />
　在调试模式下，TJS2的运行速度会变慢，但会启用一些对调试有用的功能。<br />
<br />
<dl>
<dt>类型信息跟踪功能</dt>
<dd>　TJS2对象的相关信息会被增强。<br />
　在非调试模式下，例如在KAG中想获取kag.saveSystemVariables的信息，在控制台输入<code class="inlinecode">kag.saveSystemVariables</code>，只会显示
<br />
<code class="bq">控制台&nbsp;:&nbsp;kag.saveSystemVariables&nbsp;=&nbsp;(object)(object&nbsp;0x0279E130:0x01EB0BD4)</code>
<br />

　但在调试模式启用的情况下，会显示
<br />
<code class="bq">控制台&nbsp;:&nbsp;kag.saveSystemVariables&nbsp;=&nbsp;(object)(object&nbsp;0x0279E130[(function)&nbsp;KAGWindow.saveSystemVariables]:0x01EB0BD4[instance&nbsp;of&nbsp;class&nbsp;KAGWindow])</code>
<br />

　这样会显示类型信息（以':'分隔的两部分中，前面的部分是对象的类型，后面的部分是该对象运行的上下文）。<br />
　这个功能不仅在控制台显示值时有效，在（当前版本中）对象转换为字符串的所有过程中都会生效。<br />
</dd>
<dt>对象泄漏检测功能</dt>
<dd>　在程序结束时会警告未被删除（未释放）的对象。<br />
　TJS2本来通过垃圾回收功能，自动删除创建的对象，不需要明确指示删除。但是，由于插件或吉里吉里本身的bug、循环引用等原因，对象可能会未被删除而保留（泄漏）。<br />
　在调试模式下，程序结束时仍未释放的对象会被写入控制台日志文件。<br />
　即使只有一个对象未被释放，与该对象相关的所有对象都会被检测到，因此日志文件可能会变得非常庞大，请注意。<br />
<br />
　<a target="main" class="jump" href="f_System_exit.html">System.exit</a>方法是以接近强制终止的方式结束应用程序的方法，使用这个方法结束应用程序会导致许多对象泄漏，记录大量日志，请注意。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
循环引用是指A引用B，B引用A的情况。<br />
例如，以下脚本会创建循环引用：
<br />
<code class="bq">var&nbsp;a&nbsp;=&nbsp;%[],&nbsp;b&nbsp;=&nbsp;%[];<br />
a.b&nbsp;=&nbsp;b;&nbsp;b.a&nbsp;=&nbsp;a;</code>
<br />

在这种情况下，对象a需要b，对象b需要a。TJS2采用的垃圾回收方法（引用计数）难以检测此类情况并释放对象，因此TJS2不会检测这种情况。因此，这些对象永远不会被删除（通过明确使用invalidate运算符使其中一个对象无效可以打破循环引用）。<br />
<br />
在插件中，如果引用计数处理不当，对象可能会泄漏。在创建插件并在其中处理TJS2对象时，请充分注意引用计数的处理。<br />
</div><br />
</dd>
<dt>在正在删除的对象上执行脚本的警告</dt>
<dd>　对象在被删除或无效化时会调用finalize方法。<br />
　对象被删除的时机在TJS2中是"不确定的"，因此finalize方法可能会在奇怪的时机被调用，导致意外行为。在调试模式下，当出现这种"不稳定的时机"，即未被无效化的对象通过垃圾回收被删除并调用finalize方法时，控制台会显示警告。<br />
　警告如下所示：<br />

<br />
<code class="bq">警告:&nbsp;anonymous@0x016DFA7C(9)[(function)&nbsp;finalize]:&nbsp;正在删除中的对象&nbsp;0x0167DD44[instance&nbsp;of&nbsp;class&nbsp;A]&nbsp;上执行代码。该对象创建时的调用历史如下:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anonymous@0x016DFA7C(13)[(top&nbsp;level&nbsp;script)&nbsp;global]</code>
<br />

　为了防止这种情况，建议使用new创建的对象在使用完毕后明确使用invalidate运算符使其无效。<br />
　但是，对于Array、Dictionary、Date等没有finalize方法，或finalize方法不会引起特殊问题的类的对象，可能不需要明确无效化。<br />
　上述警告会在对象在没有明确无效化的情况下被尝试删除，并且试图在其上下文中执行TJS2脚本时显示。</dd>
<dt>调用历史获取功能</dt>
<dd>　可以从脚本中获取TJS2函数/方法调用历史。<br />
　为此可以使用<a target="main" class="jump" href="f_Scripts_getTraceString.html">Scripts.getTraceString</a>方法。<br />
　当程序中途出现问题，不知道该方法是从哪里被调用时，可以使用这个方法将调用历史输出到控制台。<br />
</dd>
</dl></div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
