<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!-- generated by to_html.pl from Var.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>使用变量</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关参考用标准样式" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="首页" />
</head>
<body>
<h1><a id="id310" name="id310">什么是变量</a>
</h1><div class="para"><div>
<br />
　在KAG中，变量就是<br />
<br />
・用于记忆某些东西的物件<br />
<br />
　仅此而已。<br />
<br />
　不过，KAG是基于<a id="id311" name="id311" class="targanchor"><dfn>TJS2</dfn></a>脚本语言的系统，KAG中的变量就是TJS2的变量本身，因此可以发挥相当强大的功能。<br />
<br />
　由于这里是教程，所以只介绍基本用法，但如果要进一步访问KAG内部的方法和属性，或直接使用吉里吉里的功能，就会陷入几乎是<em>泥潭</em>状态，所以容易沉迷的性格的人请注意(笑)。<br />
</div></div>
<h1><a id="id312" name="id312">变量的种类</a>
</h1><div class="para"><div>
　KAG的变量有3种类型。与书签保存和加载一起保存和加载的普通"<a id="id313" name="id313" class="targanchor"><dfn>游戏变量</dfn></a>"，不受书签保存和加载影响，可以始终保持值的"<a id="id314" name="id314" class="targanchor"><dfn>系统变量</dfn></a>"，以及用于临时存放值的"<a id="id315" name="id315" class="targanchor"><dfn>临时变量</dfn></a>"。"系统变量"在退出吉里吉里/KAG后，再次启动同一游戏时仍能保持其值。"临时变量"在退出吉里吉里时内容会丢失，且其值不会保存在书签中。<br />
<br />
　游戏变量被赋予了<a id="id316" name="id316" class="targanchor"><dfn>f</dfn></a>这个名称，系统变量被赋予了<a id="id317" name="id317" class="targanchor"><dfn>sf</dfn></a>这个名称，临时变量被赋予了<a id="id318" name="id318" class="targanchor"><dfn>tf</dfn></a>这个名称。<br />
<br />
　此外，KAG(或者说TJS2)的变量可以存放字符串或数值(变量中存放的内容类型称为"<a id="id319" name="id319" class="targanchor"><dfn>类型</dfn></a>")。变量可以赋予(几乎)任意名称，变量数量没有限制，字符串长度也没有限制。数值可以处理实数。<br />
　从KAG 3.x开始可以处理"数组"和"字典数组"(这里不做说明)。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　TJS2的整数类型为64位，实数类型为double(双精度)。<br />
　字符串处理零结尾的UNICODE字符串，没有长度限制。<br />
</div><br />
</div></div>
<h1><a id="id320" name="id320">可用作变量的名称</a>
</h1><div class="para"><div>
　在吉里吉里/KAG中，变量几乎可以自由命名。但是，虽说自由，吉里吉里/KAG能使用的变量名还是有规则的。<br />
<br />
<dl>
<dt>变量名可以使用半角英数字、全角字符和_(下划线)</dt>
<dd>　<em><code class="inlinecode">abc&amp;def</code></em>或<em><code class="inlinecode">a-z</code></em>这样的变量名是不能使用的。<br />
　可以使用包含下划线的名称如<em><code class="inlinecode">final_count</code></em>，或使用全角字符如<em><code class="inlinecode">主人公的名字</code></em>(所有全角符号都可以使用)。</dd>
<dt>但是，变量名开头不能是半角数字</dt>
<dd>　<em><code class="inlinecode">2friends</code></em>或<em><code class="inlinecode">3com</code></em>这样的变量名是不能使用的(全角数字开头的话是可以的)。</dd></dl><br />
　在这些变量名前面，游戏变量加上<em><code class="inlinecode">f.</code></em>，系统变量加上<em><code class="inlinecode">sf.</code></em>，临时变量加上<em><code class="inlinecode">tf.</code></em>。<br />
　例如，可以考虑以下这些变量名：<br />
<br />
<code class="inlinecode"> <em>f.flag1  sf.username  sf.playcount  tf.i  f.enokazu  f.变量其1 </em>...</code><br />
<br />
　另外，首次使用的变量作为数值都是0，作为字符串都是''(空字符串)，处于一种特殊状态。一般来说，请在使用变量之前先赋值。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　除了<em>f</em>、<em>sf</em>和<em>tf</em>之外，你可能会看到<em>kag</em>，<em>kag</em>是在直接访问KAG系统内部时使用的。<br />
</div><br />
</div></div>
<h1><a id="id321" name="id321">变量赋值</a>
</h1><div class="para"><div>
　要给变量赋值，通常使用<a id="id322" name="id322" class="targanchor"><dfn>eval</dfn></a>标签。例如，想给<code class="inlinecode">f.flag1</code>赋值1000的情况...<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;<a id="id323" name="id323" class="targanchor"><dfn>=</dfn></a>&nbsp;1000</em>&quot;]<br />
</code>
<br />

　即在变量名后写=，然后指定要赋的数值。<br />
<br />
　如果想赋值字符串，则：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.变量其1&nbsp;=&nbsp;'字符串'</em>&quot;]<br />
</code>
<br />

　即在=后指定用''括起来的字符串(注意单引号和双引号)。<br />
　不存在根据变量中存放的类型而变化名称的情况，如字符串专用变量或数值专用变量。变量的类型取决于存入的内容。<br />
<br />
　要复制其他变量的内容时：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag2</em>&quot;]<br />
</code>
<br />

<br />
这样操作。<br />
</div></div>
<h1><a id="id324" name="id324">变量运算</a>
</h1><div class="para"><div>
<br />
　如果想进行计算：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag1&nbsp;+&nbsp;1</em>&quot;]<br />
</code>
<br />

　等等。在这个例子中，将f.flag1加1后的值赋给f.flag1(也就是给f.flag1加1)。<br />
　exp属性中写入TJS2中的"<a id="id325" name="id325" class="targanchor"><dfn>表达式</dfn></a>"。<br />
　表达式中可以正常使用普通的<a id="id326" name="id326" class="targanchor"><dfn>*</dfn></a>(乘法)<a id="id327" name="id327" class="targanchor"><dfn>/</dfn></a>(除法)<a id="id328" name="id328" class="targanchor"><dfn>+</dfn></a>(加法)<a id="id329" name="id329" class="targanchor"><dfn>-</dfn></a>(减法)等常见<a id="id330" name="id330" class="targanchor"><dfn>运算符</dfn></a>(像数学表达式一样有优先级)。( )括号也可以正常使用。<br />
　例如：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag1&nbsp;+&nbsp;f.flag2&nbsp;*&nbsp;f.flag3</em>&quot;]<br />
</code>
<br />

　这样做会将f.flag2与f.flag3相乘的结果加上f.flag1后赋给f.flag1。<br />
<br />
　进行除法时使用/(斜杠)：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag2&nbsp;/&nbsp;f.flag3</em>&quot;]<br />
</code>
<br />

　在这种情况下，f.flag2除以f.flag3的结果会赋给f.flag1。<br />
　但是，如果不能整除，f.flag1会变成实数，所以如果想舍弃余数得到整数结果，请使用整数除法运算符\：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag2&nbsp;\&nbsp;f.flag3</em>&quot;]<br />
</code>
<br />

　这样表示。<br />
<br />
<br />
　另外，字符串之间的连接也使用+运算符。<br />
<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;f.flag2&nbsp;=&nbsp;'hoge'&quot;]<br />
[eval&nbsp;exp=&quot;f.flag3&nbsp;=&nbsp;'une'&quot;]<br />
[eval&nbsp;exp=&quot;<em>f.flag1=&nbsp;f.flag2&nbsp;+&nbsp;f.flag3</em>&quot;]<br />
</code>
<br />

　在上面的例子中，f.flag1中将包含'hogeune'这个字符串。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　TJS2的语法参考了JavaScript(ECMAScript)，因此与其很相似(但不完全相同)。<br />
　常规算术运算的行为几乎相同。字符串的处理和字符串与数值的混合运算也几乎相同。<br />
</div><br />
</div></div>
<h1><a id="id331" name="id331">字符串和数值</a>
</h1><div class="para"><div>
　KAG的变量不会根据用途分为字符串变量、数值变量，名称也不会改变。<br />
　存入字符串则该变量变为字符串变量，存入数值则该变量变为数值变量。<br />
　麻烦的是混合使用这些时。+运算符有各种不同的含义和用法(^^;<br />
<br />
　字符串之间的连接用+运算符，数值的加法也用+运算符，但当尝试将字符串和数值相加时，如果任一方是字符串，另一方的数值会转换为字符串并连接起来，这是规则。<br />
<br />
　例如，若f.flag2中有字符串'hoge'，f.flag3中有数值10，那么：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag2&nbsp;+&nbsp;f.flag2</em>&quot;]<br />
</code>
<br />

　此时，f.flag1中将包含'hoge10'这个字符串。<br />
<br />
　另外，有时你可能想要将字符串转换为数值。例如使用[input]标签输入的内容想作为数值处理时，这种情况也可以使用+运算符。+运算符用在要转换为数值的变量前面。例如，假设f.flag1中有字符串'20'：<br />
<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;+f.flag1</em>&quot;]<br />
</code>
<br />

<br />
　这样写，f.flag1的内容将转换为数值并再次存入f.flag1。f.flag1变为数值20。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　连续使用+运算符时需要注意。例如要将f.flag3转换为数值并加到f.flag2上时，写法如<code class="inlinecode">f.flag2++f.flag3</code>会导致错误(因为有另一个++运算符)。请留出空格写成<code class="inlinecode">f.flag2+ +f.flag3</code>。<br />
</div><br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　一元+运算符(如上例<code class="inlinecode">f.flag1 = +f.flag1</code>中的+)，如果字符串包含小数表示(如0.3等)，结果将是实数。如果只想得到整数(想舍弃小数点以下)，可以写成int +。例如上例中就是<code class="inlinecode">f.flag1 = int +f.flag1</code>。<br />
</div><br />
</div></div>
<h1><a id="id332" name="id332">变量的删除及其他</a>
</h1><div class="para"><div>
　要删除变量，使用<a id="id333" name="id333" class="targanchor"><dfn>delete</dfn></a>。<em>delete 变量名</em>可以删除该变量。<br />
　例如，要删除<code class="inlinecode">f.flag1</code>，则：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>delete&nbsp;f.flag1</em>&quot;]<br />
</code>
<br />

　这样操作。<br />
<br />
　另外，<a id="id334" name="id334" class="targanchor"><dfn>clearvar</dfn></a>标签会删除所有游戏变量。<br />
<br />
　此外，可以使用TJS2中可用的所有运算符和math对象进行三角函数等计算(虽然不知道是否需要)。详情请参考吉里吉里SDK的TJS2帮助。<br />
<br />
　可以使用<a id="id335" name="id335" class="targanchor"><dfn>,</dfn></a>(逗号)在一个eval标签内写入多个表达式。<br />
例如：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;f.first=true&quot;]<br />
[eval&nbsp;exp=&quot;f.flag0=0&quot;]<br />
[eval&nbsp;exp=&quot;f.flag1=0&quot;]<br />
</code>
<br />

　这样的表达式可以简洁地写成：<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;f.first=true<em>,</em>&nbsp;f.flag0=0<em>,</em>&nbsp;f.flag1=0&quot;]<br />
</code>
<br />

<br />
　另外，使用<a id="id336" name="id336" class="targanchor"><dfn>iscript</dfn></a>标签可以简洁地写连续的eval标签。<br />
<br />
　例如，上面的表达式可以写成：<br />
<br />

<br />
<code class="bq">[iscript]<br />
f.first=true<em>;</em><br />
f.flag0=0<em>;</em><br />
f.flag1=0<em>;</em><br />
[endscript]<br />
</code>
<br />

<br />
　请不要忘记在每个表达式后加上;(分号)。<br />
　使用,(逗号)或iscript与不使用相比会非常快速。<br />
</div></div>
<h1><a id="id337" name="id337">显示变量内容</a>
</h1><div class="para"><div>
　要在剧本中显示变量内容，使用<a id="id338" name="id338" class="targanchor"><dfn>emb</dfn></a>标签。<br />
　例如：<br />

<br />
<code class="bq">[wait&nbsp;time=200]<br />
*start<br />
[cm]<br />
[eval&nbsp;exp=&quot;f.数值=200&quot;][eval&nbsp;exp=&quot;f.mojiretu='字符串'&quot;]<br />
f.数值&nbsp;的内容&nbsp;:&nbsp;[emb&nbsp;exp=&quot;f.数值&quot;][l][r]<br />
f.mojiretu&nbsp;的内容&nbsp;:&nbsp;[emb&nbsp;exp=&quot;f.mojiretu&quot;][l][r]<br />
</code>
<br />

<br />
　执行后，会显示：<br />
<br />
f.数值 的内容 : 200<br />
f.mojiretu 的内容 : 字符串<br />
<br />
　应该是这样显示的。<br />
</div></div>
<h1><a id="id339" name="id339">实体</a>
</h1><div class="para"><div>
　实体是用变量内容替换其他标签属性值的功能。<br />
　在属性值中，写入<a id="id340" name="id340" class="targanchor"><dfn>&amp;</dfn></a>后跟变量名。<br />

<br />
<code class="bq">[wait&nbsp;time=200]<br />
*start<br />
[cm]<br />
[eval&nbsp;exp=&quot;f.fontsize=60&quot;]<br />
[font&nbsp;size=&quot;&amp;f.fontsize&quot;]大小&nbsp;60&nbsp;的文字[resetfont]<br />
</code>
<br />

<br />
　在这种情况下，font标签的size属性值被替换为f.fontsize中存储的数值60。<br />
<br />
　实际上，实体是将&amp;后面写的属性值内容作为TJS2表达式执行，然后用其结果替换属性值的功能。因此，可以在&amp;后面写TJS2表达式。<br />
</div></div>

<h1><a id="id341" name="id341">条件判断</a>
</h1><div class="para"><div>
　要判断变量是否与某个值相同，可以使用以下运算符：<br />

<br />
<code class="bq">a<a id="id342" name="id342" class="targanchor"><dfn>==</dfn></a>b&nbsp;&nbsp;&nbsp;&nbsp;当&nbsp;a&nbsp;等于&nbsp;b&nbsp;时为真(true)<br />
a<a id="id343" name="id343" class="targanchor"><dfn>!=</dfn></a>b&nbsp;&nbsp;&nbsp;&nbsp;当&nbsp;a&nbsp;不等于&nbsp;b&nbsp;时为真(true)<br />
a<a id="id344" name="id344" class="targanchor"><dfn>&lt;</dfn></a>b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当&nbsp;a&nbsp;小于&nbsp;b&nbsp;时为真(true)<br />
a<a id="id345" name="id345" class="targanchor"><dfn>&gt;</dfn></a>b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当&nbsp;a&nbsp;大于&nbsp;b&nbsp;时为真(true)<br />
</code>
<br />

<br />
　此外还可以使用&gt;=或&lt;=(大于等于、小于等于)。<br />
　这类条件判断主要在if标签中使用。<br />
<br />
　<a id="id346" name="id346" class="targanchor"><dfn>if</dfn></a>标签仅在exp指定的表达式表示真(true)时才执行endif标签之前的文本和标签。<br />
<br />

<br />
<code class="bq">[if&nbsp;exp=&quot;f.flag1<em>==</em>2&quot;]f.flag1&nbsp;是&nbsp;2[endif]<br />
[if&nbsp;exp=&quot;f.flag1<em>!=</em>2&quot;]f.flag1&nbsp;不是&nbsp;2[endif]<br />
</code>
<br />

<br />
　变量根据使用方式可以成为非常强大的功能。<br />
</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
