<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!-- generated by to_html.pl from SaveLoad.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>实现存档和读取功能</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关参考用标准样式" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="首页" />
</head>
<body>
<h1><a id="id187" name="id187">KAG的"书签"</a>
</h1><div class="para"><div>
　在KAG中，游戏的存档和读取被形象地(?)比喻为"书签"。(如果您不认同这种表述方式，可以修改MainWindow.tjs)。<br />
<br />
　关于书签数据，请参考<a target="main" class="jump" href="SaveData.html">关于书签数据</a>。<br />
<br />
　遗憾的是，在KAG中不能在任意位置进行存档和读取。必须使用<a id="id188" name="id188" class="targanchor"><dfn>可存档的标签</dfn></a>作为标记，来确定存档和读取的"位置"。<br />
<br />
　...虽然说存档和读取本身几乎可以随时通过菜单的"插入书签"和"跟随书签"来完成，但是存档时会保存玩家最近经过的"存档位置"。<br />
　因此，即使玩家在远离该"位置"的地方存档，在读取时依然会从最后经过的"位置"重新开始。<br />
<br />
　成为存档位置的是标签。不过，作为存档位置的标签与普通标签的写法略有不同。<br />
<br />
　请看下面的例子。<br />
<br />

<br />
<code class="bq">[wait&nbsp;time=20]<br />
<em>*start|开始</em><br />
[cm]<br />
这里是开始位置[l][r]<br />
<br />
<em>*label2|存档位置2</em><br />
[cm]<br />
这里是存档位置2[l][r]<br />
<br />
<em>*label3|存档位置3</em><br />
[cm]<br />
这里是存档位置3[l][r]<br />
[jump&nbsp;target=*start]<br />
</code>
<br />

<br />
　如上所示，在标签后面添加|(竖线)，然后在其后指定该存档位置的名称作为"<a id="id189" name="id189" class="targanchor"><dfn>标题</dfn></a>"。标题可以重复。标题会显示在"插入书签"菜单的菜单项中，因此应该为用户设置容易理解的名称。此外，在自由存档模式下也将作为默认文件名。<br />
　如果想使用jump标签等跳转到带|的标签，则不能指定|后面的部分。上面的例子中有[jump target=*start]，这样通过target属性等指定标签时，必须省略|后面的内容。<br />
<br />
　标题可以按照以下方式省略。<br />

<br />
<code class="bq">*label|<br />
</code>
<br />

　在这种情况下，将继承上次通过时的标题。<br />
<br />
　另外，如果在|后面加上&，可以将变量的内容作为标题。例如，<br />

<br />
<code class="bq">*label|&amp;f.title<br />
</code>
<br />

　这样会使用f.title变量的内容作为标题。<br />
<br />
　标签名(|前面的部分)在同一个剧本文件中不能重复(在不同的剧本文件中可以重复)。相比之下，标题只在内部处理，只要剧本创作者注意即可。<br />
　此外，在这类标签后面必须写[cm]。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">注意</span></div>
　也可以用[ct]代替[cm]。两者的区别在于，ct将操作对象的消息层设置为表页的message0，而cm只是清除所有消息层，不改变操作对象的消息层。<br />
　之所以必须写这种清除消息层的标签，是因为<em>书签中不会保存消息层上写了什么</em>。<br />
　另外，建议不要在trans标签和wt标签之间等"执行需要时间的处理的标签"和"等待该处理的标签"之间写可存档的标签。</div><br />
<br />
　此外，没有写|的普通标签位置不能进行存档。<br />
<br />
　...需要注意的就这些<code class="inlinecode">(^^)</code><br />
<br />
　这类作为存档位置的标签越多，用户可以存档的位置就越多。创建标签只是创建，并不意味着必须编写相应的跳转标签。<br />
　但请特别注意，这类标签后面必须写[cm]。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">注意</span></div>
　从内部来看，当KAG通过带|(可存档的)标签时，KAG会暂时将当时的状态保存在内部。当用户选择保存书签时，保存的就是那时的数据。</div><br />
</div></div>
<h1><a id="id190" name="id190">disablestore标签的使用方法</a>
</h1><div class="para"><div>
　<a id="id191" name="id191" class="targanchor"><dfn>disablestore</dfn></a>标签可以临时禁用"插入书签"功能。<br />
　可存档的标签不需要写在游戏正文之前的位置，比如主菜单等地方，因为在这些地方保存书签没有意义。<br />
　KAG在启动后，在尚未通过可存档的标签之前，"插入书签"功能不可用。<br />
　因此，在进入游戏正文之前不写任何可存档的标签就好，但是这样一来，当游戏结束返回主菜单时，如果已经通过了可存档的标签，那么在主菜单也能插入书签了。<br />
　为了防止这种情况，除了在进入游戏正文之前不写可存档的标签外，还需要在主菜单等处使用<code class="inlinecode">[disablestore]</code>来禁用"插入书签"功能。<br />
　使用<code class="inlinecode">[disablestore]</code>后，就像KAG启动时一样，在通过可存档的标签之前，"插入书签"功能将不可用。<br />
</div></div>
<h1><a id="id192" name="id192">startanchor标签的使用方法</a>
</h1><div class="para"><div>
　<a id="id193" name="id193" class="targanchor"><dfn>startanchor</dfn></a>标签用于启用"返回开始"菜单。<br />
　KAG的菜单栏中有"系统|返回开始..."。<br />
　这个菜单默认情况下不能选择。<br />
　要指定返回位置，需要在希望"返回开始"菜单被选择时返回的位置添加<code class="inlinecode">[startanchor]</code>标签。该标签应该写在可存档的标签之后。在这个<code class="inlinecode">[startanchor]</code>之后，"返回开始"菜单将变为可用。<br />
　另外，如果在主菜单等地方不想让用户使用"返回开始"功能，可以使用<code class="inlinecode">[startanchor enabled=false]</code>。在这种情况下，在再次通过<code class="inlinecode">[startanchor]</code>之前，"返回开始"功能将处于不可用状态。<br />
<br />
　"返回开始"的功能类似于跟随startanchor标签所在位置的书签，但是游戏变量<span class="comlink"> ( → <a target="main" class="jump" href="Var.html">使用变量</a> ) </span>将全部保持原样(保留)。<br />
</div></div>
<h1><a id="id194" name="id194">标签名的重复或省略</a>
</h1><div class="para"><div>
　如果同一个剧本文件中有相同的标签名(|前面的部分)，第一个标签保持不变，但之后的标签会自动添加<code class="inlinecode">:2</code>或<code class="inlinecode">:3</code>等序号。<br />
　例如，<br />
<br />

<br />
<code class="bq"><em>*start|开始</em><br />
<em>*start|存档位置2</em><br />
<em>*start|存档位置3</em><br />
</code>
<br />

<br />
在这种情况下，第一个*start是&quot;<code class="inlinecode">*start</code>&quot;，但如果想跳转到下一个*start，需要在target属性中使用&quot;<code class="inlinecode">*start:2</code>&quot;。再下一个是&quot;<code class="inlinecode">*start:3</code>&quot;。<br />
<br />
　另外，省略标签名时，将视为指定了与之前相同的标签名，并添加序号。
　例如，<br />
<br />

<br />
<code class="bq"><em>*start|开始</em><br />
<em>*|存档位置2</em><br />
<em>*|存档位置3</em><br />
</code>
<br />

<br />
　在这种情况下，第二个标签是&quot;<code class="inlinecode">*start:2</code>&quot;。第三个标签是&quot;<code class="inlinecode">*start:3</code>&quot;。<br />
<br />
　同时省略标签和标题时，写法如下。<br />
<br />

<br />
<code class="bq"><em>*start|开始</em><br />
<em>*|</em><br />
<em>*|</em><br />
</code>
<br />

<br />
　这种写法在编写可存档标签时很方便，因为不需要为每个标签指定不同的标签名，但由于标签是通过序号管理的，如果编辑剧本文件，减少或增加中间的标签，可能会导致跟随书签时无法回到原位置，或使用return标签时无法返回原位置。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">注意</span></div>
省略标题时，会继承之前通过的可存档标签的标题，而省略标签名时，无论是否通过，都会继承剧本文件中前面的标签名。<br />
</div><br />
</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
