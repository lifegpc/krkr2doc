<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh">
<!-- generated by to_html.pl from ClickableMap.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>使用可点击地图</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关参考用标准样式" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="首页" />
</head>
<body>
<h1><a id="id7" name="id7">什么是可点击地图</a>
</h1><div class="para"><div>
　可点击地图直译就是可以"点击"的"地图"，是在一张图像中定义几个"区域"，使其可以通过鼠标等点击进行选择的工具。<br />
<br />
　在吉里吉里/KAG中，除了主体图像外，还使用"<a id="id8" name="id8" class="targanchor"><dfn>区域图像</dfn></a>"和"<a id="id9" name="id9" class="targanchor"><dfn>区域动作定义文件</dfn></a>"这两个文件来实现此功能。<br />
</div></div>
<h1><a id="id10" name="id10">什么是区域图像</a>
</h1><div class="para"><div>
　区域图像是与主体图像相同大小的256色图像。不能使用全彩色图像。JPEG不适合这种用途，请使用PNG或BMP等支持256色的图像格式。<br />
<br />
　区域图像是对应主体图像中各个区域，用任意的<a id="id11" name="id11" class="targanchor"><dfn>调色板索引</dfn></a>填充各区域的图像。例如，<br />
<br /><div class="descimg"><img width="365" height="379" alt="map1.png" src="map1.png" /><img width="365" height="379" alt="map1_p.png" src="map1_p.png" /><br />主体图像(左)和区域图像(右)</div><br />　如上所示。左边是主体图像，这个例子是关东地区的地图。右边是对应每个都县，填充了各个区域的"区域图像"。<br />
　区域图像是用任意（各自不同的）调色板索引填充各个区域的图像。上例中各区域上标注的数字就是调色板索引（这是为了说明而添加的，实际上不需要）。用调色板索引0（图中的海洋部分）填充的区域不作为可用区域。<br />
<br />
　一些图形编辑软件支持处理256色图像的"调色板索引"，需要使用这类软件进行编辑（可能会被称为调色板号、颜色索引、索引颜色、颜色编号等不同名称）。这里重要的是调色板索引（颜色编号），而不是颜色本身。吉里吉里在查看区域图像时，只关注调色板索引而非颜色。颜色可以设置为编辑时容易区分各区域的适当颜色即可。<br />
<br />
　区域图像的文件名通常是主体图像文件名（不含扩展名）加上_p。例如，如果主体图像名为map.png，则区域图像的文件名（如果保存为PNG格式）应为map_p.png。<br />
</div></div>
<h1><a id="id12" name="id12">什么是区域动作定义文件</a>
</h1><div class="para"><div>
　区域动作定义文件是定义可点击地图各区域行为的文件。<br />
　扩展名为.ma，通常与主体图像文件使用相同的文件名。例如，如果主体图像名为map.png，则区域动作定义文件名应为map.ma。<br />
<br />
　区域动作定义文件是文本文件，可用文本编辑器编辑。<br />
<br />
　区域动作定义文件每一行包含"区域编号：动作"，按区域数量编写（冒号为半角）。<br />
　例如，对于上述地图示例，<br />

<br />
<code class="bq">11:&nbsp;hint=&quot;埼玉&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m11&quot;;<br />
8:&nbsp;hint=&quot;群马&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m8&quot;;<br />
7:&nbsp;hint=&quot;栃木&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m7&quot;;<br />
9:&nbsp;hint=&quot;茨城&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m9&quot;;<br />
10:&nbsp;hint=&quot;千叶&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m10&quot;;<br />
12:&nbsp;hint=&quot;东京&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m12&quot;;<br />
2:&nbsp;hint=&quot;神奈川&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m2&quot;;<br />
3:&nbsp;hint=&quot;山梨&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m3&quot;;<br />
1:&nbsp;hint=&quot;静冈&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m1&quot;;<br />
4:&nbsp;hint=&quot;长野&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m4&quot;;<br />
5:&nbsp;hint=&quot;新潟&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m5&quot;;<br />
6:&nbsp;hint=&quot;福岛&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m6&quot;;<br />
</code>
<br />

　这样的描述。区域编号与上例区域图像的调色板索引一致。<br />
　"<a id="id13" name="id13" class="targanchor"><dfn>动作</dfn></a>"（冒号后的部分）脱离KAG语法，采用TJS语法编写，但并不复杂。<br />
　格式为"名称=值;"，根据需要编写。请不要忘记分号。<br />
<br />
　可使用的名称包括以下几种：<br />
<dl>
<dt>storage, target, onenter, onleave, hint, exp, countpage </dt>
<dd>&nbsp;&nbsp;&nbsp;&nbsp;　这些与link标签具有相同功能，但所有属性值都必须用&quot; &quot;（双引号）括起来（如上例所示）。如果不用&quot; &quot;括起来，可能会出错或无法正常工作。</dd>
<dt>cursor</dt>
<dd>&nbsp;&nbsp;&nbsp;&nbsp;　指定鼠标光标在区域上时的形状。类似于cursor标签的指定，但使用以cr开头的鼠标光标常量时，不需要添加&amp;直接写出（例如  cursor = crSizeAll; ）。指定鼠标光标文件时，需用&quot; &quot;（双引号）括起来（例如  cursor = &quot;wagtail.ani&quot;; ）。</dd></dl><br />
　在区域动作定义文件中，区域编号0用于特殊指定。当前版本可使用autodisable。例如，
<br />
<code class="bq">0&nbsp;:&nbsp;autodisable=false;</code>
<br />

　这样设置后，点击可点击地图不会使可点击地图变为无效（不可操作）状态。通常不需要此指定。<br />
　如果不进行此指定，或区域动作定义文件中没有区域编号0的指定，则点击可点击地图后，它将变为无效（不可操作）状态，直到再次通过<a id="id14" name="id14" class="targanchor"><dfn>image</dfn></a>标签或<a id="id15" name="id15" class="targanchor"><dfn>mapaction</dfn></a>标签加载区域动作定义文件。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　如果没有定义任何动作，该区域将被忽略。例如，如果想根据条件启用或禁用区域，可以使用TJS的if语句，如：<br />
11: if(f.flag == 1) { hint=&quot;埼玉&quot;; storage=&quot;maptest2.ks&quot;; target=&quot;*m11&quot;; }<br />
　这表示只有当f.flag为1时，才定义"hint=&quot;埼玉&quot;; storage=&quot;maptest2.ks&quot;; target=&quot;*m11&quot;;"这个动作。</div><br />
</div></div>

<h1><a id="id16" name="id16">尝试使用可点击地图</a>
</h1><div class="para"><div>
　让我们尝试使用可点击地图。<br />
　上述例子中，主体图像为map1.png，区域图像为map1_p.png，区域动作定义文件为map1.ma。<br />
　image标签会根据要加载的主体文件名，查找文件名加上_p的文件和扩展名为ma的文件，分别作为区域图像和区域动作定义文件加载。<br />
　因此，通常只需使用image标签即可启用可点击地图。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
&nbsp;&nbsp;&nbsp;&nbsp;　如需单独加载区域图像或区域动作定义文件，可分别使用<a id="id17" name="id17" class="targanchor"><dfn>mapimage</dfn></a>标签和mapaction标签。</div><br />
　例如，在maptest.ks中写入以下内容：<br />

<br />
<code class="bq">*start<br />
@image&nbsp;layer=0&nbsp;page=fore&nbsp;visible=true&nbsp;storage=map1<br />
@position&nbsp;left=400&nbsp;width=220<br />
@wt<br />
可点击地图测试。<br />
@s<br />
</code>
<br />

　仅需这些，就可以在可点击地图可用的状态下通过s标签停止。<br />
<br />
<br /><div class="descimg"><img width="650" height="528" alt="clickable.png" src="clickable.png" /><br />运行后的画面</div><br /><br />
　还需编写点击可点击地图时跳转的场景。例如，在maptest2.ks中写入以下内容：<br />

<br />
<code class="bq">*m11<br />
@cm<br />
那是埼玉。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m8<br />
@cm<br />
那是群马。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m7<br />
@cm<br />
那是栃木。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m9<br />
@cm<br />
那是茨城。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m10<br />
@cm<br />
那是千叶。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m12<br />
@cm<br />
那是东京。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m2<br />
@cm<br />
那是神奈川。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m3<br />
@cm<br />
那是山梨。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m1<br />
@cm<br />
那是静冈。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m4<br />
@cm<br />
那是长野。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m5<br />
@cm<br />
那是新潟。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m6<br />
@cm<br />
那是福岛。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
</code>
<br />

<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　当KAG中存在使用可点击地图的图像时（无论是否显示或表里），键盘的光标键将切换到模拟鼠标移动的模式。因此，其他使用键盘的功能（如edit标签）可能无法正常使用。<br />
　使用完毕后，请通过mapdisable标签禁用它，或者在该层加载其他图像或使用freeimage标签销毁可点击地图，以恢复正常的键盘操作模式。</div><br />
</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
