<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!-- generated by to_html.pl from ttjs.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>tTJS</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关参考标准样式" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="首页" />
</head>
<body>
<h1><a id="id384" name="id384">什么是tTJS</a>
</h1><div class="para"><div>
　TJS2脚本引擎的类。通过这个类的对象可以操作TJS2。<br />
</div></div>
<h1><a id="id385" name="id385">构造函数</a>
</h1><div class="para"><div>
　tTJS的构造函数没有参数。<br />
　tTJS对象不能作为自动变量创建。必须使用new运算符创建。<br />
　创建后的引用计数为1。这意味着如果直接调用Release方法，tTJS对象就会被释放。<br />
</div></div>
<h1><a id="id386" name="id386">析构函数</a>
</h1><div class="para"><div>
　tTJS的析构函数在保护区中，无法访问。<br />
　要释放tTJS对象，请使用Release方法。<br />
　此外，在释放tTJS对象之前，建议调用Shutdown方法。<br />
</div></div>

<h1><a id="id387" name="id387">AddRef</a>
</h1><div class="para"><div>
void tTJS::AddRef()<br />
<br />
　增加TJS2脚本引擎的引用计数。</div></div>
<h1><a id="id388" name="id388">Release</a>
</h1><div class="para"><div>
void tTJS::Release()<br />
<br />
　减少TJS2脚本引擎的引用计数。<br />
　如果引用计数变为0，tTJS对象将被释放。</div></div>
<h1><a id="id389" name="id389">Shutdown</a>
</h1><div class="para"><div>
void tTJS::Shutdown()<br />
<br />
　关闭脚本引擎。<br />
<br />
　在释放TJS2脚本引擎时，建议在调用Release方法之前调用此方法。<br />
</div></div>

<h1><a id="id390" name="id390">GetGlobal</a>
</h1><div class="para"><div>
iTJSDispatch2 * tTJS::GetGlobal()<br />
<br />
　获取<a id="id391" name="id391" class="targanchor"><dfn>global对象</dfn></a>。返回一个<a target="main" class="jump" href="interface.html">iTJSDispatch2接口</a>类型的对象。<br />
　此方法在返回global对象时会增加其引用计数。<br />
</div></div>



<h1><a id="id392" name="id392">GetGlobalNoAddRef</a>
</h1><div class="para"><div>
iTJSDispatch2 * tTJS::GetGlobalNoAddRef()<br />
<br />
　获取global对象。与GetGlobal的区别在于不增加global对象的引用计数。<br />
</div></div>



<h1><a id="id393" name="id393">SetConsoleOutput</a>
</h1><div class="para"><div>
void tTJS::SetConsoleOutput(iTJSConsoleOutput *console);<br />
<br />
　指定<a id="id394" name="id394" class="targanchor"><dfn>控制台</dfn></a>的输出目标。<br />
　控制台是输出TJS2错误消息等信息的地方。<br />
<br />
有以下参数：<br />
<br />
<dl>
<dt>console</dt>
<dd>　指定定义控制台输出目标的<a id="id395" name="id395" class="targanchor"><dfn>iTJSConsoleOutput</dfn></a>类型对象。<br />
　iTJSConsoleOutput类型是在tjs.h中定义的基本抽象类，有以下方法：<br />
<br />
<dl>
<dt>void iTJSConsoleOutput::<a id="id396" name="id396" class="targanchor"><dfn>ExceptionPrint</dfn></a>(const tjs_char *msg)</dt>
<dd>　用于输出与异常相关信息的方法。msg表示消息内容。</dd>
<dt>void iTJSConsoleOutput::<a id="id397" name="id397" class="targanchor"><dfn>Print</dfn></a>(const tjs_char *msg)</dt>
<dd>　用于输出其他信息的方法。msg表示消息内容。</dd></dl></dd></dl>
</div></div>

<h1><a id="id398" name="id398">GetConsoleOutput</a>
</h1><div class="para"><div>
tTJSConsoleOutput * tTJS::GetConsoleOutput() const<br />
<br />
　获取控制台的输出目标。<br />
</div></div>

<h1><a id="id399" name="id399">OutputToConsole</a>
</h1><div class="para"><div>
void tTJS::OutputToConsole(const tjs_char *msg) const<br />
<br />
　向控制台输出字符串。msg是要输出的消息。<br />
</div></div>


<h1><a id="id400" name="id400">OutpuExceptionToConsole</a>
</h1><div class="para"><div>
void tTJS::OutpuExceptionToConsole(const tjs_char *msg) const<br />
<br />
　向控制台输出异常字符串。msg是要输出的消息。<br />
</div></div>



<h1><a id="id401" name="id401">OutputToConsoleWithCentering</a>
</h1><div class="para"><div>
void tTJS::OutputToConsoleWithCentering(const tjs_char *msg, tjs_uint width) const<br />
<br />
　向控制台居中输出字符串。msg是要输出的消息，width是宽度。<br />
　如果输出消息的字符数少于宽度，则在指定宽度的中央居中输出
 (但会将所有字符的宽度视为相同，因此如果混有全角字符会导致显示错乱)</div></div>





<h1><a id="id402" name="id402">OutputToConsoleSeparator</a>
</h1><div class="para"><div>
void tTJS::OutputToConsoleSeparator(const tjs_char *text, tjs_uint count) const<br />
<br />
　将text指示的分隔符号输出count个到控制台。</div></div>




<h1><a id="id403" name="id403">Dump</a>
</h1><div class="para"><div>
void tTJS::Dump(tjs_uint width = 80) const<br />
<br />
　将TJS2的状态输出到控制台。<br />
　显示各脚本块中虚拟机代码的反汇编结果等。<br />
　width指定输出的宽度。</div></div>


<h1><a id="id404" name="id404">ExecScript</a>
</h1><div class="para"><div>
void tTJS::ExecScript(<br />
&nbsp;&nbsp;&nbsp;&nbsp;const tjs_char *script,<br />
&nbsp;&nbsp;&nbsp;&nbsp;tTJSVariant *result = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;iTJSDispatch2 *context = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;const tjs_char *name = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;tjs_int lineofs = 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;)<br />
<br />
void tTJS::ExecScript(<br />
&nbsp;&nbsp;&nbsp;&nbsp;const ttstr &amp;script,<br />
&nbsp;&nbsp;&nbsp;&nbsp;tTJSVariant *result = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;iTJSDispatch2 *context = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;const tjs_char *name = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;tjs_int lineofs = 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;)<br />
<br />
　执行脚本。<br />
<br />
　有以下参数：<br />
<br />
<dl>
<dt>const tjs_char *script</dt>

<dt>const ttstr &amp;script</dt>
<dd>　指定要执行的脚本。</dd>


<dt>tTJSVariant *result</dt>
<dd>　指定接收结果的tTJSVariant类型变量的指针。<br />
　也可以指定NULL，但如果是NULL则无法接收结果。</dd>
<dt>iTJSDispatch2 *context</dt>
<dd>　指定该脚本将在其中执行的上下文。<br />
　如果指定NULL，脚本将在global上下文中执行。<br />
　通常指定NULL，但如果想在特定上下文中执行脚本，请指定作为该上下文的对象。</dd>


<dt>const tjs_char *name</dt>
<dd>　指定脚本的名称。通常指定该脚本的文件名。<br />
　在异常通知时用于告知异常发生在哪个脚本中。</dd>

<dt>tjs_int lineofs</dt>
<dd>　指定脚本中，该脚本开始的行（从0开始）。<br />
　对于像KAG场景中嵌入的TJS脚本这样嵌入在其他文档中的TJS脚本，指定该TJS脚本的开始行。<br />
　在异常通知时用于告知异常发生在哪个脚本中。</dd>


</dl></div></div>

<h1><a id="id405" name="id405">EvalExpression</a>
</h1><div class="para"><div>
void tTJS::EvalExpression(<br />
&nbsp;&nbsp;&nbsp;&nbsp;const tjs_char *expression,<br />
&nbsp;&nbsp;&nbsp;&nbsp;tTJSVariant *result = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;iTJSDispatch2 *context = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;const tjs_char *name = NULL<br />
&nbsp;&nbsp;&nbsp;&nbsp;tjs_int lineofs = 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;)<br />
<br />
void tTJS::EvalExpression(<br />
&nbsp;&nbsp;&nbsp;&nbsp;const ttstr &amp;expression,<br />
&nbsp;&nbsp;&nbsp;&nbsp;tTJSVariant *result = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;iTJSDispatch2 *context = NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;const tjs_char *name = NULL<br />
&nbsp;&nbsp;&nbsp;&nbsp;tjs_int lineofs = 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;)<br />
<br />
　评估表达式。<br />
　关于参数，请参考ExecScript。<br />
<br />
　对于<a id="id406" name="id406" class="targanchor"><dfn>if运算符</dfn></a>等无法获取表达式结果的运算符，如果尝试获取其结果并为result指定非NULL值，将引发异常。在这种情况下，需要为result指定NULL。</div></div>




<h1><a id="id407" name="id407">SetPPValue</a>
</h1><div class="para"><div>
void tTJS::SetPPValue(const tjs_char *name, const tjs_int32 value)<br />
<br />
　设置<a id="id408" name="id408" class="targanchor"><dfn>条件编译</dfn></a>用的变量。name是变量名，value是要设置的值。<br />
</div></div>



<h1><a id="id409" name="id409">GetPPValue</a>
</h1><div class="para"><div>
tjs_int32 tTJS::GetPPValue(const tjs_char *name)<br />
<br />
　获取条件编译用的变量。name是变量名。如果找不到变量，返回0。<br />
</div></div>




<h1><a id="id410" name="id410">DoGarbageCollection</a>
</h1><div class="para"><div>
tjs_int32 tTJS::DoGarbageCollection()<br />
<br />
　执行<a id="id411" name="id411" class="targanchor"><dfn>垃圾回收</dfn></a>。清除TJS2持有的缓存，完成未处理的清理操作。<br />
</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
